<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>WiFiController</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <script>
      function checkRelayWarning() {
        const vlanInput = document.getElementById('vlan');
        const dhcpRelayCheckbox = document.getElementById('dhcpRelayCheckbox');
        const warningDiv = document.getElementById('dhcpRelayWarning');
        if (vlanInput && vlanInput.value && !dhcpRelayCheckbox.checked) {
          warningDiv.style.display = '';
          warningDiv.innerHTML = `DHCP Relay <b>etkin değil!</b> Eğer bu SSID'ye ait VLAN'dan IP almak istiyorsanız, merkezi DHCP sunucunuzun bu VLAN'ı dinlemesi ve portunuzun trunk olması gerekmektedir. Aksi halde istemciler IP alamaz.`;
        } else {
          warningDiv.style.display = 'none';
          warningDiv.innerHTML = '';
        }
      }
      document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('vlan').addEventListener('input', checkRelayWarning);
        document.getElementById('dhcpRelayCheckbox').addEventListener('change', checkRelayWarning);
      });
    </script>
</head>
<body class="container mt-4">
    <h2>WiFiController - SSID Oluştur</h2>
    <form id="ssidForm">
        <div class="mb-3">
            <label for="ssid" class="form-label">SSID</label>
            <input type="text" class="form-control" id="ssid" name="ssid" required>
        </div>
        <div class="mb-3">
            <label for="password" class="form-label">Şifre</label>
            <input type="password" class="form-control" id="password" name="password" required>
        </div>
        <div class="mb-3">
            <label for="vlan" class="form-label">VLAN (Opsiyonel)</label>
            <input type="number" class="form-control" id="vlan" name="vlan" min="1" max="4094" placeholder="Ör: 20">
        </div>
        <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" id="dhcpRelayCheckbox" name="dhcp_relay">
            <label class="form-check-label" for="dhcpRelayCheckbox">
                DHCP Relay Aktif
            </label>
        </div>
        <div id="dhcpRelayWarning" class="text-warning small" style="display:none"></div>
        <button type="submit" class="btn btn-primary mt-3">Ekle</button>
    </form>
    <div id="result" class="mt-4"></div>
    <script>
      document.getElementById('ssidForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const ssid = document.getElementById('ssid').value;
        const password = document.getElementById('password').value;
        const vlan = document.getElementById('vlan').value;
        const dhcpRelay = document.getElementById('dhcpRelayCheckbox').checked;
        const payload = { ssid, password, vlan, dhcp_relay: dhcpRelay };
        const response = await fetch('/api/ssids', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const data = await response.json();
        document.getElementById('result').innerText = data.message || JSON.stringify(data);
      });
    </script>
</body>
</html>
