<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>WiFi Controller Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
  <style>
    body { background: #f8f9fa; padding: 40px; }
    .card { margin-bottom: 30px; }
    .qrcode { margin-top: 10px; }
    .qr-popup {
      position: absolute; background: #fff; border: 1px solid #ccc;
      border-radius: 8px; padding: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      z-index: 1000; min-width: 200px; min-height: 200px; visibility: hidden;
    }
    .qr-popup .close-btn {
      position: absolute; top: 8px; right: 8px; font-size: 1.2rem;
      color: #888; background: #fff; border: none; cursor: pointer;
      line-height: 1; transition: color 0.2s;
    }
    .qr-popup .close-btn:hover { color: #e22; }
    .list-group-item-editing { background-color: #e9ecef; opacity: 0.7; }
    #ssidList li { position: relative; }
  </style>
</head>
<body>
<div class="container">
  <h2 class="mb-4">WiFi Controller Panel</h2>

  <!-- Uplink seçimi -->
  <div class="card mb-4">
    <div class="card-header">Uplink (Kablolu İnternet)</div>
    <div class="card-body">
      <select id="uplinkInterface" class="form-select">
        <option disabled selected>Yükleniyor…</option>
      </select>
    </div>
  </div>

  <!-- Wi-Fi Kartı Seç -->
  <div class="card mb-4">
    <div class="card-header">Wi-Fi Kartı Seç</div>
    <div class="card-body">
      <select id="wifiInterface" class="form-select">
        <option value="" disabled selected>Yükleniyor…</option>
      </select>
      <div id="interfaceWarning" class="text-danger mt-2"></div>
    </div>
  </div>

  <!-- Tanımlı SSID'ler -->
  <div class="card mb-4">
    <div class="card-header">Tanımlı SSID'ler</div>
    <div class="card-body">
      <ul class="list-group" id="ssidList"></ul>
    </div>
  </div>

  <!-- Yeni SSID Ekle / Düzenle -->
  <div class="card">
    <div class="card-header" id="formHeader">Yeni SSID Ekle veya Düzenle</div>
    <div class="card-body">
      <fieldset id="newSsidFieldset" disabled>
        <!-- ... mevcut form alanlarınız ... -->
      </fieldset>
      <div id="newWifiMessage" class="mt-3"></div>
    </div>
  </div>
</div>

<script>
  const maxBroadcasts = {};
  let ssidList = [], isEditing = false, editingIndex = null;

  document.addEventListener("DOMContentLoaded", () => {
    disableForm();
    fetchUplinks();
    fetchInterfaces();
    fetchSsids();
    document.getElementById("wifiInterface")
            .addEventListener("change", onInterfaceChange);
  });

  function fetchUplinks() {
    fetch('/api/uplinks')
      .then(r => r.json())
      .then(d => {
        const sel = document.getElementById('uplinkInterface');
        sel.innerHTML = '<option disabled selected>Bir arayüz seçin</option>';
        d.uplinks.forEach(i => sel.append(new Option(i, i)));
      });
  }

  // ... fetchInterfaces(), fetchSsids(), renderList(), onInterfaceChange(), etc. ...
</script>
</body>
</html>
